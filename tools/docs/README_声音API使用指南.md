# 声音转能量密度曲线 API 使用指南

## 📖 目录
1. [如何找到 cURL 命令](#如何找到-curl-命令)
2. [手动配置方式](#手动配置方式)
3. [使用步骤](#使用步骤)

---

## 🔍 如何找到 cURL 命令

### 方法一：在 Apipost 文档中查找

1. **打开 API 文档页面**
   - 访问：https://docs.apipost.net/docs/detail/5a08548640ca000?target_id=2080ba74725004&locale=zh-cn

2. **查找"生成代码"按钮**
   - 在页面右上角或请求区域附近，查找以下按钮之一：
     - **"生成代码"** 或 **"Code"**
     - **"</>"** 图标
     - **"复制 cURL"** 或 **"Copy cURL"**
   
   ![查找位置示意图]
   - 通常在页面右侧工具栏
   - 或者在请求参数区域的上方

3. **选择 cURL 格式**
   - 点击按钮后，会弹出代码生成窗口
   - 选择 **"cURL"** 或 **"curl"** 格式

4. **复制完整命令**
   - 点击"复制"按钮
   - 确保复制的是**完整的命令**（通常很长，包含 `--data-binary` 参数）

### 方法二：如果找不到 cURL 按钮

如果文档页面没有明显的"生成代码"按钮，可以：

1. **查看请求示例区域**
   - 有些文档会在"请求示例"或"代码示例"部分直接显示 cURL 命令

2. **使用浏览器开发者工具**
   - 按 `F12` 打开开发者工具
   - 在 Apipost 页面中点击"发送"按钮
   - 在 Network（网络）标签中查看请求
   - 右键点击请求 → "Copy" → "Copy as cURL"

3. **直接使用手动配置方式**（见下方）

---

## ✋ 手动配置方式

如果找不到 cURL 命令，可以直接手动输入参数：

### 需要的信息

从 API 文档中查找以下信息：

1. **API URL（接口地址）**
   - 通常在文档顶部或"请求地址"部分
   - 例如：`https://api.example.com/v1/sound/convert`

2. **请求头（Headers）**
   - 查找"请求头"或"Headers"部分
   - 常见的有：
     - `Authorization`: 认证 Token
     - `Accept`: 接受的内容类型
     - `Cookie`: 会话 Cookie（如果有）

3. **表单参数（Form Data）**
   - 查找"请求参数"或"Body"部分
   - 通常包括：
     - `files`: 文件参数名（可能是 `file`、`files`、`audio` 等）
     - `freq1`: 开始频率（例如：20）
     - `freq2`: 结束频率（例如：20000）
     - `freqCount`: 分段数量（例如：3000）
     - `sampleFrq`: 采样频率（例如：192000）
     - `engP`: 能量指数（例如：1.25）
     - 其他参数...

### 手动配置示例

运行脚本时，选择 **"2. 手动输入API URL和Token"**，然后按提示输入：

```
请输入API URL: https://api.example.com/v1/sound/convert
请输入Token: your_token_here（如果有的话）
```

**注意**：手动配置方式目前只支持基本的 URL 和 Token。如果需要完整的表单参数支持，建议使用 cURL 命令方式。

---

## 🚀 使用步骤

### 步骤 1：运行脚本

```bash
python tools/test_sound_api.py
```

### 步骤 2：选择配置方式

```
选择配置方式:
1. 从cURL命令导入配置（推荐）
2. 手动输入API URL和Token
请选择 (1/2):
```

- **选择 1**：如果您有 cURL 命令（从 Apipost 文档复制）
- **选择 2**：如果找不到 cURL 命令，手动输入基本信息

### 步骤 3：配置 API

#### 方式 1：使用 cURL 命令
```
请粘贴完整的cURL命令（包含--data-binary参数）:
提示: 可以从Apipost文档中复制cURL命令

cURL命令: [在这里粘贴完整的cURL命令]
```

#### 方式 2：手动输入
```
请从Apipost文档中获取完整的API接口URL
请输入API URL: [输入API地址]

如果需要认证，请输入Token（或按回车跳过）:
Token: [输入Token，或直接回车跳过]
```

### 步骤 4：选择模式

```
选择模式:
1. 单文件测试
2. 批量转换
请选择 (1/2):
```

- **选择 1**：测试单个音频文件
- **选择 2**：批量处理目录中的所有音频文件

### 步骤 5：提供文件路径

#### 单文件测试
```
请输入音频文件路径: D:\audio\test.wav
```

#### 批量转换
```
请输入音频文件目录路径: D:\audio_files
```

### 步骤 6：查看结果

脚本会自动：
- 调用 API
- 解析响应数据
- 保存结果到 `sound_api_output` 目录
- 生成 JSON 和 XLSX 格式的文件

---

## ❓ 常见问题

### Q1: 找不到"生成代码"按钮怎么办？

**A**: 可以尝试：
1. 使用浏览器开发者工具（F12）查看网络请求
2. 或者使用手动配置方式（选择方式 2）

### Q2: cURL 命令太长了，复制不完整怎么办？

**A**: 
- 确保在代码生成窗口中点击"复制"按钮，而不是手动选择文本
- 或者将命令保存到文本文件，然后从文件读取
- 

### Q3: 提示"无法解析cURL命令"怎么办？

**A**: 
- 检查是否复制了完整的命令（包含 `--data-binary` 参数）
- 确保命令格式正确（没有多余的换行或空格）
- 可以尝试手动配置方式

### Q4: API 返回 401 认证错误？

**A**: 
- 检查 Token 是否有效
- 确认 Token 是否已过期
- 查看 API 文档中的认证说明

### Q5: 如何修改 API 参数（如频率范围）？

**A**: 
- 如果使用 cURL 命令方式，参数会自动从命令中提取
- 如果需要修改，可以在 Apipost 文档中修改参数后重新生成 cURL 命令

---

## 📝 示例

### 完整使用流程示例

```bash
# 1. 运行脚本
python tools/test_sound_api.py

# 2. 选择配置方式
请选择 (1/2): 1

# 3. 粘贴 cURL 命令（从 Apipost 文档复制）
cURL命令: curl 'https://workspace.apipost.net/proxy/v2/http' -X POST ...

# 4. 选择模式
请选择 (1/2): 1

# 5. 输入文件路径
请输入音频文件路径: D:\audio\test.wav

# 6. 查看结果
[成功] API调用成功: test.wav
  频率点数: 3000
  频率范围: 20.00 - 20000.00 Hz
  ...
```

---

## 💡 提示

1. **首次使用建议**：先用单文件测试模式验证 API 是否正常工作
2. **批量处理**：确认单文件测试成功后，再使用批量转换模式
3. **保存结果**：结果会自动保存，可以随时查看 `sound_api_output` 目录
4. **参数调整**：如果需要修改 API 参数，建议在 Apipost 文档中修改后重新生成 cURL 命令

---

## 📞 需要帮助？

如果遇到问题：
1. 检查 API 文档是否可访问
2. 确认网络连接正常
3. 查看错误提示信息
4. 尝试使用手动配置方式
